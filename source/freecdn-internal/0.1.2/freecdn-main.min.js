!function(){"use strict";var t;!function(t){const{getOwnPropertyDescriptor:e,defineProperty:s}=Object;function i(t,e,s){const i=t[e];if(!i)return!1;const n=s(i);return t[e]=n,!0}t.func=i,t.prop=function(t,n,a,r){const o=e(t,n);return!!o&&(a&&i(o,"get",a),r&&i(o,"set",r),s(t,n,o),!0)}}(t||(t={}));const e="freecdn-internal/0.1.2",s=/\.(?:jpg|jpeg|png|apng|gif|ico|bmp)$/i,i=fetch,n=new Uint8Array(0),a=location.host,r=crypto.subtle;class o extends Error{constructor(t){super(t)}}class c{onRequest(t,e){}onResponse(t,e,s){}onData(t){return t}onEnd(t){return t}onError(t){}onAbort(t){}}var l;!function(t){let e;t.set=async function(t){const s=Q(t);s&&(e=await r.importKey("spki",s,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]))},t.verify=async function(t){if(!e)return!1;const s=t.lastIndexOf(10),i=G(t.subarray(s+1)).match(/# SIGN: ([A-Za-z0-9+/=]{88})$/);if(!i)return!1;const n=Q(i[1]),a=t.subarray(0,s);return await r.verify({name:"ECDSA",hash:{name:"SHA-256"}},e,n,a)}}(l||(l={}));const p=/^(?:\/|https?:|@).*/gm;class h{constructor(){this.urlFileMap=new Map}has(t){return this.urlFileMap.has(t)}get(t){return this.urlFileMap.get(t)}getParams(t){const e=this.get(t);if(e)return e.parse(),e.params}async parse(t){this.parseFile(t+"\n@__default__\n expires=30s\n mime=auto\n open_timeout=10s\n");const e=this.urlFileMap.get("@include");if(e){const t=new v;t.manifest=this;const s=e.getLines().map(t.fetchText,t);(await Promise.all(s)).forEach(this.parseFile,this)}}parseFile(t){let e="",s=0;for(;;){const i=p.exec(t);if(s>0){"@"!==e[0]&&(e=encodeURI(pt(e)));const n=i?i.index:t.length,a=t.substring(s,n),r=new f(e,a);this.urlFileMap.set(e,r)}if(!i)break;e=i[0],s=p.lastIndex}const i=this.getParams("@__default__"),n=this.getParams("@global");this.globalParams=n?new Map([...i,...n]):i}}class u{constructor(t,e){this.fileParams=e,[this.url,this.frag]=at(pt(t),"#")}static init(){this.nameClassMap={open_timeout:S,recv_timeout:U,referrer_policy:P,req_headers:F,headers:N,expires:D,mime:z,charset:E,pos:A,size:L,xor:B,br:q,prefix:T,suffix:_,hash:R,stream:I},Object.values(this.nameClassMap).forEach(((t,e)=>{t.priority=e})),z.init()}parse(t){const e=new Map;rt(e,t.globalParams);const s="/"===this.url[0]?a:ot(this.url),i=t.getParams("@host "+s);if(i&&rt(e,i),rt(e,this.fileParams),this.frag){rt(e,new URLSearchParams(this.frag))}const n=[];for(const[t,s]of e){const e=u.nameClassMap[t];if(!e){console.warn("[FreeCDN/UrlConf] unknown param:",t);continue}const i=e.parseConf(s);if(void 0===i)continue;if("string"==typeof i){console.warn("[FreeCDN/UrlConf] parseConf failed. mod:",t,"err:",i,"conf:",s);continue}const a=new e(...i);n.push(a)}return n.sort(((t,e)=>t.constructor.priority-e.constructor.priority)),n}}class m{constructor(t,e){this.url=t,this.paramMods=e,this.abortCtrl=new AbortController,this.isNetErr=!1,this.isDone=!1,this.isAborted=!1,this.bytesRead=0}async request(t){let e;try{e=await this.requestUnsafe(t)}catch(t){console.assert(t instanceof o,t),e=t}if(e&&!this.isAborted){for(const t of this.paramMods)t.onError(e);this.onError(e),this.isNetErr||this.abort(e)}}async requestUnsafe(t){const{rawReq:e}=t,{method:s}=e,i={method:s,referrer:e.referrer,referrerPolicy:"same-origin",headers:new Headers};"POST"!==s&&"PUT"!==s||(i.body=await e.clone().arrayBuffer());for(const e of this.paramMods)e.onRequest(i,t);i.signal=this.abortCtrl.signal;const a=new Request(this.url,i);let r;try{r=await H.fetch(a)}catch(t){return this.isNetErr=!0,t}const{status:o}=r;if(200!==o)return new Error("invalid http status. code: "+o);const c={status:r.status,statusText:r.statusText,headers:new Headers};for(const e of this.paramMods)e.onResponse(c,t,r);if(this.onResponse(c),!r.body)return new Error("cors error");const l=r.body.getReader();let p;t:for(;;){try{const{done:t,value:e}=await l.read();if(!e){console.assert(t);break}p=e}catch(t){return this.isNetErr=!0,t}for(const t of this.paramMods){const e=t.onData(p);if(p=e instanceof Promise?await e:e,0===p.length)continue t}p.length>0&&(this.pauseSignal&&await this.pauseSignal,this.bytesRead+=p.length,this.onData(p))}this.isDone=!0,p=n;for(const t of this.paramMods){const e=t.onEnd(p);p=e instanceof Promise?await e:e}p.length>0&&(this.pauseSignal&&await this.pauseSignal,this.bytesRead+=p.length,this.onData(p)),this.onEnd()}pause(){console.assert(!this.pauseSignal),this.pauseSignal=j()}resume(){this.pauseSignal?.resolve(),this.pauseSignal=null}abort(t){if(!this.isDone){this.isAborted=!0,this.abortCtrl.abort();for(const e of this.paramMods)e.onAbort(t)}}}const d=/^\s+([^#\s].+?)\s*$/gm;class f{constructor(t,e){this.name=t,this.text=e}getLines(){const t=[];for(;;){const e=d.exec(this.text);if(!e)break;t.push(e[1])}return this.text="",t}parse(){if(""===this.text)return;const t=[],e=new Map;for(const s of this.getLines())if(/^https?:|^\//.test(s)){const i=new u(s,e);t.push(i)}else{const[t,i]=at(s,"=");if(void 0===i){console.warn("[FreeCDN/FileConf] missing param value:",s);continue}e.set(t,i)}this.params=e,this.urlConfs=t}}const g=["open_timeout","recv_timeout","hash","req_headers"];class x extends Error{constructor(t){super(t)}}class w{constructor(t,e,s,i){this.fileConf=t,this.rawReq=e,this.manifest=s,this.suffix=i,this.urlLoaderSet=new Set,this.delayTid=0,this.urlErrs=[],this.opened=!1,this.closed=!1,this.bytesRead=0;const n=e.headers.get("range");if(n){const e=this.parseReqRange(n);e&&([this.rangeBegin,this.rangeEnd]=e,this.hasRange=!0,this.bytesRead=this.rangeBegin);const s=t.params.get("size");s&&(this.fileSize=+s)}const a=new Map;for(const e of g){const s=t.params.get(e);void 0!==s&&a.set(e,s)}const r=new u(t.name,a);this.urlConfs=t.urlConfs.concat(r)}parseReqRange(t){const e=t.match(/bytes=(\d+)-(\d*)/i);if(!e)return;const s=+e[1],i=+e[2];return 0!==i&&i<=s?void 0:[s,i]}buildResRange(t){let e=0;0!==this.rangeEnd?e=this.rangeEnd-1:this.fileSize&&(e=this.fileSize-1);const s="bytes "+this.rangeBegin+"-"+e+"/"+(this.fileSize||"*");t.status=206,t.headers.set("content-range",s)}open(){this.loadNextUrl()}pause(){for(const t of this.urlLoaderSet)t.pause()}resume(){for(const t of this.urlLoaderSet)t.resume()}abort(t){for(const e of this.urlLoaderSet)e.abort(t);0!==this.delayTid&&clearTimeout(this.delayTid)}getNextUrl(){const{urlConfs:t}=this,e=t.length-1;if(-1===e)return;const s=st();let i=-1e4,n=0;t.forEach(((t,e)=>{const a=H.getUrlScore(t.url,s);a>i&&(i=a,n=e)}));const a=t[n];return t[n]=t[e],t.length=e,{score:i,conf:a}}loadNextUrl(t=0){const e=this.getNextUrl();if(!e){if(0===this.urlLoaderSet.size){const t=this.fileConf.name+this.suffix,e=new x("failed to load: "+t);e.urlErrs=this.urlErrs,this.onError(e)}return}const{score:s,conf:i}=e;s<0&&t>0?this.delayTid=setTimeout((()=>{this.delayTid=0,this.createUrlLoader(i)}),t):this.createUrlLoader(i)}createUrlLoader(t){const e=t.url+this.suffix,s=t.parse(this.manifest),i=new m(e,s);this.urlLoaderSet.add(i),i.onData=t=>{if(this.closed)return;const e=i.bytesRead-this.bytesRead;if(!(e<=0)){if(e!==t.length&&(t=t.subarray(-e)),this.bytesRead=i.bytesRead,this.rangeEnd){const e=this.bytesRead-this.rangeEnd;if(e>0)return t=t.subarray(0,-e),this.onData(t),void i.onEnd()}this.onData(t)}},i.onEnd=()=>{this.closed||(this.closed=!0,this.onEnd(),this.abort("TASK_DONE"))},i.onError=t=>{this.urlErrs.push({url:i.url,err:t}),this.urlLoaderSet.delete(i),this.loadNextUrl()},i.onResponse=t=>{this.opened||(this.hasRange&&this.buildResRange(t),this.opened=!0,this.onOpen(t))},i.request(this)}}const b=new Map;class y{constructor(t,e){this.freecdn=t,this.urlWsMap=new Map,this.wsArgs="",this.updating=!1,this.manifestHash=n,this.pollingTimer=0,this.pollingInterval=3e5,this.lastTime=0,this.setSvcTimer=0,this.backupUrls=[];const s=new URL(e,location.href);console.assert(s.host===a);const i=s.pathname+s.search;"/freecdn-manifest.txt"!==i&&(this.wsArgs="?manifest="+encodeURIComponent(i)),this.manifestUrl=i}async getManifestFromCache(){const t=await O.findCache(this.manifestUrl);if(!t)return;const e=await t.arrayBuffer(),s=new Uint8Array(e);if(!await l.verify(s))return;const i=G(s),n=new h;return await n.parse(i),n}async init(){const t=await this.getManifestFromCache();if(!t)return void await this.update();const e=t.getParams("@update");e&&this.parseBackupParam(e),await this.update()||(console.warn("[FreeCDN/Updater] use cached manifest"),this.freecdn.manifest=t,this.applyConfs(t))}async update(){if(this.updating)return!0;const t=Date.now();if(t-this.lastTime<1e3)return!0;this.lastTime=t,this.updating=!0;try{return await this.updateUnsafe()}catch(t){return console.error("[FreeCDN/Updater] update err:",t),!1}finally{this.updating=!1}}async updateUnsafe(){const t=await this.fetchManifest(this.manifestUrl);if(t)return await this.applyManifest(t),!0;if(console.warn("[FreeCDN/Updater] failed to fetch 1st manifest:",this.manifestUrl),0===this.backupUrls.length)return console.warn("[FreeCDN/Updater] no backup url"),!1;for(const t of this.backupUrls){const e=await this.fetchManifest(t);if(e){if(await l.verify(e))return await this.applyManifest(e),!0;console.warn("[FreeCDN/Updater] failed to verify 3rd manifest:",t)}else console.warn("[FreeCDN/Updater] failed to fetch 3rd manifest:",t)}return console.warn("[FreeCDN/Updater] failed to reload"),!1}async fetchManifest(t){const e=new AbortController,s=setTimeout((()=>{e.abort()}),3e3),i=new Request(t,{cache:"no-cache",signal:e.signal});try{const t=await H.fetch(i),e=await t.arrayBuffer();return new Uint8Array(e)}catch{}finally{clearTimeout(s)}}async applyManifest(t){const e=await ht(t);if(nt(this.manifestHash,e))return;this.manifestHash=e;const s=new Response(t);O.addCache(this.manifestUrl,s);const i=new h,n=G(t);await i.parse(n),this.freecdn.manifest=i,this.applyConfs(i)}applyConfs(t){this.applyUpdateParams(t.getParams("@update")||b)}applyUpdateParams(t){this.backupUrls=this.parseBackupParam(t);const e=this.parseIntervalParam(t);this.setPollingInterval(e);const s=this.parseServicesParam(t);this.setSvcTimer>0&&clearTimeout(this.setSvcTimer),this.setSvcTimer=setTimeout((()=>{this.setSvcTimer=0,this.setServices(s)}),5e3)}parseBackupParam(t){return J(t.get("backup")||"")}parseIntervalParam(t){const e=t.get("interval");if(e){const t=tt(e);if(!isNaN(t))return t;console.warn("[FreeCDN/Updater] invalid interval:",e)}return 3e5}parseServicesParam(t){return J(t.get("services")||"")}setPollingInterval(t){this.pollingInterval!==t&&(this.pollingInterval,this.pollingTimer&&clearInterval(this.pollingTimer),t>0&&(this.pollingTimer=setInterval((()=>{this.update()}),t)))}setServices(t){for(const[e,s]of this.urlWsMap)t.includes(e)||(s.onclose=null,s.close(),this.urlWsMap.delete(e));for(const e of t)this.urlWsMap.has(e)||this.createSvc(e)}createSvc(t){const e=new WebSocket(t+this.wsArgs);e.binaryType="arraybuffer",e.onmessage=t=>{const e=new Uint8Array(t.data);nt(this.manifestHash,e)||this.update()},e.onclose=()=>{this.urlWsMap.delete(t),setTimeout((()=>{this.createSvc(t)}),2e4)},this.urlWsMap.set(t,e)}}class v{constructor(t){this.enableCacheStorage=!0,this.inited=!1,t&&(this.updater=new y(this,t))}static async globalInit(){if(this.globalInited)return this.globalInited;this.globalInited=j(),await O.init(),await H.init(),u.init(),this.globalInited.resolve(),this.globalInited=!0}async fetch(t,e){const s=t instanceof Request&&!e?t:new Request(t,e);if(!/^https?:/.test(s.url))return i(s);const{manifest:n}=this;if(!n)return H.fetch(s);const a=this.tryFile(n,s);if(!a)return H.fetch(s);if(a instanceof Response)return a;let r,o="";a instanceof Array?[r,o]=a:r=a;const c=n.get(r);c.parse();let l="";const p=c.params.get("hash");p&&44===p.length&&(l=p);const h=this.enableCacheStorage&&l;if(h){const t=await O.findHash(l);if(t)return t}const u=new w(c,s,n,o),m=j();if(l)return u.onOpen=t=>{u.onData=e=>{const i=new Response(e,t);if(h&&e.length<5242880){const t=i.clone();t.headers.set("content-length",e.length+""),t.headers.set("x-raw-url",s.url),O.addHash(l,t)}m.resolve(i)}},u.onError=t=>{console.warn("[FreeCDN]",t.message,t.urlErrs),m.reject(t)},u.onEnd=()=>{},u.open(),m;let d,f=!1;const g=()=>{const{desiredSize:t}=d;null!==t&&(t<=0?f||(u.pause(),f=!0):f&&(u.resume(),f=!1))},x=new ReadableStream({start(t){d=t},pull(){g()},cancel(t){console.warn("[FreeCDN] stream cancel:",t),u.abort(t)}});return u.onData=t=>{d.enqueue(t),g()},u.onEnd=()=>{d.close()},u.onError=t=>{d.error(),console.warn("[FreeCDN]",t.message,t.urlErrs),m.reject(t)},u.onOpen=t=>{const e=new Response(x,t);m.resolve(e)},u.open(),m}async fetchText(t){return(await this.fetch(t)).text()}async fetchBin(t){const e=await this.fetch(t),s=await e.arrayBuffer();return new Uint8Array(s)}async fetchBlob(t){const e=await this.fetch(t),s=await e.arrayBuffer(),i=e.headers.get("content-type")||"";return new Blob([s],{type:i})}async update(){return!!this.updater&&this.updater.update()}async setPublicKey(t){124!==t.length&&(t=`MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE${t}==`),await l.set(t)}set preservePerformanceEntries(t){H.preservePerformanceEntries(t)}async init(){console.assert(!this.inited),this.inited=!0,await v.globalInit(),this.updater&&await this.updater.init()}tryFile(t,e){const i=new URL(e.url),n=i.host===a?"":i.origin,r=i.pathname.replace(/\/{2,}/g,"/"),o=n+r;if(s.test(o)&&"cors"!==e.mode&&!e.integrity){const s=e.headers.get("accept")||"";if(s.includes("image/avif")&&t.has(o+".avif"))return o+".avif";if(s.includes("image/webp")&&t.has(o+".webp"))return o+".webp"}if(t.has(o))return o;if(o.endsWith("/")&&t.has(o+"index.html"))return o+"index.html";if(t.has(o+"/index.html"))return Response.redirect(o+"/");let c=r.replace(/[^/]*$/,"");for(;;){if(t.has(n+c)){return[n+c,r.substr(c.length)+i.search]}if("/"===c)break;c=c.replace(/[^/]+\/$/,"")}}}function j(){let t,e;const s=new Promise(((s,i)=>{t=s,e=i}));return s.resolve=t,s.reject=e,s}var C;!function(e){const s=self,i=new Response("/* freecdn is installed */",{headers:{"content-type":"text/javascript","cache-control":"max-age=3600"}});let n,a,r;async function o(t,e){a&&await a;const s=t instanceof Request&&!e?t:new Request(t,e),i=await n.fetch(s);return r.set(i,s.url),i}function c(t,e,s){const a=t.request;a.url.endsWith("/freecdn-update")?n.update().then((t=>{const s=new Response("updated. success: "+t,{headers:{"content-type":"text/html"}});e(s)})):a.url!==location.href?n.fetch(a).then(e,s):e(i.clone())}!async function(){n=new v("freecdn-manifest.txt");const e=s.FREECDN_SHARED_MODE;let i;e?(n.enableCacheStorage=!1,n.preservePerformanceEntries=!0,a=j(),t.func(s,"fetch",(t=>o)),t.func(Cache.prototype,"add",(t=>async function(t){const e=await o(t);await this.put(t,e)})),t.func(Cache.prototype,"addAll",(t=>async function(t){const e=t.map((t=>this.add(t)));await Promise.all(e)})),r=new WeakMap,t.prop(Response.prototype,"url",(t=>function(){return r.get(this)||t.call(this)}),null),t.func(Response.prototype,"clone",(t=>function(){const e=t.call(this),s=r.get(this);return s&&r.set(e,s),e})),i=s.FREECDN_PUBLIC_KEY):i=s.Q.shift(),i&&await n.setPublicKey(i),await n.init(),e?(a?.resolve(),a=null):function(){const t=s.Q;for(t.push=c;t.length;)c(...t.splice(0,3))}(),console.log("[FreeCDN] service worker inited")}()}(C||(C={}));class q extends c{constructor(){super(),this.state=0}static async init(){if(this.signal)return;this.signal=j();const t=`${e}/br/br.wasm`,s=`${e}/br/br.min.js`,i=`\n${t}\n\thttps://cdn.jsdelivr.net/npm/freecdn-js@0.1.2/dist/br/br.wasm\n\thttps://unpkg.com/freecdn-js@0.1.2/dist/br/br.wasm\n\thash=w7Zbum/oD8CzP5UKtRDW8+0bmoFIHs06PfiGF42t0uw=\n\n${s}\n\thttps://cdn.jsdelivr.net/npm/freecdn-js@0.1.2/dist/br/br.min.js\n\thttps://unpkg.com/freecdn-js@0.1.2/dist/br/br.min.js\n\thash=gqmgnA8vf/OANpMvdOnpyPZ1Un4WqQZonOsf2FqndZg=\n`,n=()=>{this.hasErr=!0,this.signal?.resolve()},a=setTimeout(n,2e4),r={locateFile:()=>t,onRuntimeInitialized:()=>{this.inPtr=r._AllocInBuf(131072),this.outPtr=r._AllocOutBuf(524288),clearTimeout(a),this.signal?.resolve(),this.signal=void 0},onAbort:t=>{console.warn("[FreeCDN/Br] wasm onAbort:",t),n()},print:t=>{console.warn("[FreeCDN/Br] wasm print:",t)},printErr:t=>{console.warn("[FreeCDN/Br] wasm printErr:",t)}},o=new h;await o.parse(i);const c=new v;c.manifest=o;const l=async(...t)=>{try{return await c.fetch(...t)}catch(t){throw console.warn("[FreeCDN/Br] failed to load wasm"),n(),t}};try{const t=await c.fetchText(s);Function("Module","fetch",t)(r,l)}catch{return console.warn("[FreeCDN/Br] failed to execute glue js"),void n()}this.asmMod=r}static parseConf(t){if("off"!==t)return"on"===t?(this.asmMod||this.init(),[]):"invalid value"}onData(t){return q.signal?this.pending(t):this.process(t)}onEnd(t){let e=n;return t.length>0&&(e=this.process(t)),this.destory(),e}async pending(t){if(await q.signal,q.hasErr)throw new o("failed to load br decoder");return this.process(t)}process(t){const e=q.asmMod,s=e.HEAPU8;0===this.state&&(this.state=e._Init());const i=[];for(let n=0;n<t.length;n+=131072){const a=t.subarray(n,n+131072);s.set(a,q.inPtr);let r=a.length,c=0;do{if(0===e._Update(this.state,0,r)){const t=e._GetErrorCode();throw this.destory(),new o("br decode failed. code: "+t)}r=e._GetAvailableIn(),c=e._GetAvailableOut();const t=524288-c;if(0===t)continue;const n=s.slice(q.outPtr,q.outPtr+t);i.push(n)}while(e._HasMoreOutput(this.state))}return 1===i.length?i[0]:it(i)}destory(){q.asmMod._Destroy(this.state)}}q.hasErr=!1;const k=/^text\/|^application\/(?:javascript|json)|\+xml$/;class E extends c{constructor(t){super(),this.charset=t}static parseConf(t){if("off"!==t)return[t]}onResponse(t){const e=t.headers.get("content-type")||"";k.test(e)&&t.headers.set("content-type",e+"; charset="+this.charset)}}E.reuse=!0;class D extends c{constructor(t){super(),this.seconds=t}static parseConf(t){const e=tt(t)/1e3|0;return isNaN(e)?"invalid time format":[e]}onResponse(t){t.headers.append("cache-control","max-age="+this.seconds)}}D.reuse=!0;class R extends c{constructor(t,e){super(),this.blkLen=t,this.hashArr=e,this.queueArr=[],this.queueLen=0,this.hasData=!1}static parseConf(t){let e=1/0,s=t;const i=t.indexOf(";");if(i>0){const n=t.substr(0,i);if(s=t.substr(i+1),e=et(n),isNaN(e))return"invalid block length"}const n=[],a=s.split(",");for(let t=a.length-1;-1!==t;t--){const e=Q(a[t]);if(!e||32!==e.length)return"invalid block hash";n.push(e)}return[e,n]}async onData(t){if(this.hasData=!0,this.queueLen+=t.length,this.queueLen>67108864)throw new o("max queue length exceeded");if(this.queueLen>=this.blkLen){const e=this.queueLen%this.blkLen;if(e){const s=t.subarray(0,-e);this.queueArr.push(s),this.queueLen-=e}else this.queueArr.push(t);const s=await this.pull();if(this.queueLen=e,e){const s=t.subarray(-e);this.queueArr.push(s)}return s}return this.queueArr.push(t),n}async onEnd(t){return t.length>0&&(this.queueLen+=t.length,this.queueArr.push(t)),0===this.queueLen?(this.hasData||await this.verify(n),n):this.pull()}async pull(){const t=it(this.queueArr,this.queueLen);this.queueArr.length=0;for(let e=0;e<t.length;e+=this.blkLen){const s=t.subarray(e,e+this.blkLen);await this.verify(s)}return t}async verify(t){const e=this.hashArr.pop();if(!e)throw new o("missing hash");const s=await ht(t);if(!nt(e,s)){const t=Z(e),i=Z(s);throw new o("hash incorrect. expected: "+t+", but got: "+i)}}}class N extends c{constructor(t,e){super(),this.headers=t,this.preserveAll=e}static parseConf(t){return F.parse(t)}onResponse(t,e,s){if(this.preserveAll){for(const[e,i]of s.headers)t.headers.set(e,i);for(const[e,s]of this.headers)t.headers.set(e,s)}else for(const[e,i]of this.headers)if(""===i){const i=s.headers.get(e);null!==i&&t.headers.set(e,i)}else t.headers.set(e,i)}}N.reuse=!0;class S extends c{constructor(t){super(),this.time=t,this.tid=0}static parseConf(t){const e=tt(t);return isNaN(e)?"invalid time format":[e]}onRequest(t,e){this.tid=setTimeout((()=>{const t=Math.max(this.time,5e3);e.loadNextUrl(t)}),this.time)}onResponse(){this.stopTimer()}onError(){this.stopTimer()}onAbort(){this.stopTimer()}stopTimer(){this.tid>0&&(clearTimeout(this.tid),this.tid=0)}}class A extends c{constructor(t){super(),this.done=!1,this.remain=t}static parseConf(t){const e=et(t);return isNaN(e)?"invalid byte format":0!==e?[e]:void 0}onData(t){if(this.done)return t;const e=this.remain-=t.length;return e>0?n:(this.done=!0,0===e?n:t.subarray(e))}onEnd(t){return this.onData(t)}}class T extends c{constructor(t){super(),this.bytes=t,this.done=!1}static parseConf(t){const e=V(t);return e?[e]:"invalid format"}onData(t){return this.done?t:(this.done=!0,it([this.bytes,t]))}onEnd(t){return this.onData(t)}}class U extends c{constructor(t,e){super(),this.bytes=t,this.time=e,this.tid=0,this.sum=0}static parseConf(t){const[e,s]=t.split("/"),i=et(e),n=tt(s);return isNaN(i)?"invalid byte format":isNaN(n)?"invalid time format":[i,n]}onRequest(t,e){this.fileLoader=e}onResponse(){this.tid=setInterval((()=>{this.sum<=this.bytes&&(this.stopTimer(),this.fileLoader.loadNextUrl()),this.sum=0}),this.time)}onData(t){return this.sum+=t.length,t}onEnd(t){return this.stopTimer(),t}onError(){this.stopTimer()}onAbort(){this.stopTimer()}stopTimer(){this.tid>0&&(clearTimeout(this.tid),this.tid=0)}}const M=/^(?:no-referrer|unsafe-url|origin|same-origin|strict-origin|no-referrer-when-downgrade|origin-when-cross-origin|strict-origin-when-cross-origin)$/;class P extends c{constructor(t){super(),this.policy=t}static parseConf(t){return"raw"===t?[""]:M.test(t)?[t]:"invalid value"}onRequest(t,e){t.referrerPolicy=this.policy||e.rawReq.referrerPolicy}}P.reuse=!0;class F extends c{constructor(t,e){super(),this.headers=t,this.preserveAll=e}static parse(t){const e=[];let s=!1;const i=Y(t);if("object"!=typeof i)return"invalid format";for(const[t,n]of Object.entries(i)){if("string"!=typeof n)return"invalid header";"*"===t?s=!0:e.push([t,n])}return[e,s]}static parseConf(t){return this.parse(t)}onRequest(t,e){const{rawReq:s}=e;if(this.preserveAll){for(const[e,i]of s.headers)t.headers.set(e,i);for(const[e,s]of this.headers)t.headers.set(e,s)}else for(const[e,i]of this.headers)if("referer"!==e)if(""===i){const i=s.headers.get(e);null!==i&&t.headers.set(e,i)}else t.headers.set(e,i);else t.referrer=i||s.referrer}}F.reuse=!0;class L extends c{constructor(t){super(),this.size=t,this.done=!1,this.remain=t}static parseConf(t){const e=et(t);return isNaN(e)?"invalid byte format":[e]}onData(t){if(this.done)return n;const e=this.remain-=t.length;return e>0?t:(this.done=!0,0===e?t:t.subarray(0,e))}onEnd(t){return this.onData(t)}}class I extends c{constructor(){super(),this.queueArr=[],this.queueLen=0}static parseConf(t){if("on"!==t)return"off"===t?[]:"invalid value"}onData(t){if(this.queueLen+=t.length,this.queueLen>67108864)throw new o("max queue length exceeded");return this.queueArr.push(t),n}onEnd(t){return t.length>0&&this.onData(t),it(this.queueArr,this.queueLen)}}class _ extends c{constructor(t){super(),this.bytes=t}static parseConf(t){const e=V(t);return e?[e]:"invalid format"}onEnd(t){return 0===t.length?this.bytes:it([t,this.bytes])}}_.reuse=!0;class B extends c{constructor(t){super(),this.key=t}static parseConf(t){const e=0|+t;return e<0||e>255?"invalid value":[e]}onData(t){for(let e=0;e<t.length;e++)t[e]^=this.key;return t}onEnd(t){return this.onData(t)}}B.reuse=!0;class z extends c{constructor(t){super(),this.mime=t}static init(){const t=new Map;for(const e of"application/andrew-inset:ez;application/applixware:aw;application/atom+xml:atom;application/atomcat+xml:atomcat;application/atomdeleted+xml:atomdeleted;application/atomsvc+xml:atomsvc;application/atsc-dwd+xml:dwd;application/atsc-held+xml:held;application/atsc-rsat+xml:rsat;application/bdoc:bdoc;application/calendar+xml:xcs;application/ccxml+xml:ccxml;application/cdfx+xml:cdfx;application/cdmi-capability:cdmia;application/cdmi-container:cdmic;application/cdmi-domain:cdmid;application/cdmi-object:cdmio;application/cdmi-queue:cdmiq;application/cu-seeme:cu;application/dash+xml:mpd;application/davmount+xml:davmount;application/docbook+xml:dbk;application/dssc+der:dssc;application/dssc+xml:xdssc;application/ecmascript:ecma,es;application/emma+xml:emma;application/emotionml+xml:emotionml;application/epub+zip:epub;application/exi:exi;application/fdt+xml:fdt;application/font-tdpfr:pfr;application/geo+json:geojson;application/gml+xml:gml;application/gpx+xml:gpx;application/gxf:gxf;application/gzip:gz;application/hjson:hjson;application/hyperstudio:stk;application/inkml+xml:ink,inkml;application/ipfix:ipfix;application/its+xml:its;application/java-archive:jar,war,ear;application/java-serialized-object:ser;application/java-vm:class;application/javascript:js,mjs;application/json:json,map;application/json5:json5;application/jsonml+json:jsonml;application/ld+json:jsonld;application/lgr+xml:lgr;application/lost+xml:lostxml;application/mac-binhex40:hqx;application/mac-compactpro:cpt;application/mads+xml:mads;application/manifest+json:webmanifest;application/marc:mrc;application/marcxml+xml:mrcx;application/mathematica:ma,nb,mb;application/mathml+xml:mathml;application/mbox:mbox;application/mediaservercontrol+xml:mscml;application/metalink+xml:metalink;application/metalink4+xml:meta4;application/mets+xml:mets;application/mmt-aei+xml:maei;application/mmt-usd+xml:musd;application/mods+xml:mods;application/mp21:m21,mp21;application/mp4:mp4s,m4p;application/mrb-consumer+xml:xdf;application/mrb-publish+xml:xdf;application/msword:doc,dot;application/mxf:mxf;application/n-quads:nq;application/n-triples:nt;application/node:cjs;application/octet-stream:bin,dms,lrf,mar,so,dist,distz,pkg,bpk,dump,elc,deploy,exe,dll,deb,dmg,iso,img,msi,msp,msm,buffer;application/oda:oda;application/oebps-package+xml:opf;application/ogg:ogx;application/omdoc+xml:omdoc;application/onenote:onetoc,onetoc2,onetmp,onepkg;application/oxps:oxps;application/p2p-overlay+xml:relo;application/patch-ops-error+xml:xer;application/pdf:pdf;application/pgp-encrypted:pgp;application/pgp-signature:asc,sig;application/pics-rules:prf;application/pkcs10:p10;application/pkcs7-mime:p7m,p7c;application/pkcs7-signature:p7s;application/pkcs8:p8;application/pkix-attr-cert:ac;application/pkix-cert:cer;application/pkix-crl:crl;application/pkix-pkipath:pkipath;application/pkixcmp:pki;application/pls+xml:pls;application/postscript:ai,eps,ps;application/provenance+xml:provx;application/pskc+xml:pskcxml;application/raml+yaml:raml;application/rdf+xml:rdf,owl;application/reginfo+xml:rif;application/relax-ng-compact-syntax:rnc;application/resource-lists+xml:rl;application/resource-lists-diff+xml:rld;application/rls-services+xml:rs;application/route-apd+xml:rapd;application/route-s-tsid+xml:sls;application/route-usd+xml:rusd;application/rpki-ghostbusters:gbr;application/rpki-manifest:mft;application/rpki-roa:roa;application/rsd+xml:rsd;application/rss+xml:rss;application/rtf:rtf;application/sbml+xml:sbml;application/scvp-cv-request:scq;application/scvp-cv-response:scs;application/scvp-vp-request:spq;application/scvp-vp-response:spp;application/sdp:sdp;application/senml+xml:senmlx;application/sensml+xml:sensmlx;application/set-payment-initiation:setpay;application/set-registration-initiation:setreg;application/shf+xml:shf;application/sieve:siv,sieve;application/smil+xml:smi,smil;application/sparql-query:rq;application/sparql-results+xml:srx;application/srgs:gram;application/srgs+xml:grxml;application/sru+xml:sru;application/ssdl+xml:ssdl;application/ssml+xml:ssml;application/swid+xml:swidtag;application/tei+xml:tei,teicorpus;application/thraud+xml:tfi;application/timestamped-data:tsd;application/toml:toml;application/ttml+xml:ttml;application/ubjson:ubj;application/urc-ressheet+xml:rsheet;application/urc-targetdesc+xml:td;application/voicexml+xml:vxml;application/wasm:wasm;application/widget:wgt;application/winhlp:hlp;application/wsdl+xml:wsdl;application/wspolicy+xml:wspolicy;application/xaml+xml:xaml;application/xcap-att+xml:xav;application/xcap-caps+xml:xca;application/xcap-diff+xml:xdf;application/xcap-el+xml:xel;application/xcap-error+xml:xer;application/xcap-ns+xml:xns;application/xenc+xml:xenc;application/xhtml+xml:xhtml,xht;application/xliff+xml:xlf;application/xml:xml,xsl,xsd,rng;application/xml-dtd:dtd;application/xop+xml:xop;application/xproc+xml:xpl;application/xslt+xml:xsl,xslt;application/xspf+xml:xspf;application/xv+xml:mxml,xhvml,xvml,xvm;application/yang:yang;application/yin+xml:yin;application/zip:zip;audio/3gpp:3gpp;audio/adpcm:adp;audio/amr:amr;audio/basic:au,snd;audio/midi:mid,midi,kar,rmi;audio/mobile-xmf:mxmf;audio/mp3:mp3;audio/mp4:m4a,mp4a;audio/mpeg:mpga,mp2,mp2a,mp3,m2a,m3a;audio/ogg:oga,ogg,spx,opus;audio/s3m:s3m;audio/silk:sil;audio/wav:wav;audio/wave:wav;audio/webm:weba;audio/xm:xm;font/collection:ttc;font/otf:otf;font/ttf:ttf;font/woff:woff;font/woff2:woff2;image/aces:exr;image/apng:apng;image/avif:avif;image/bmp:bmp;image/cgm:cgm;image/dicom-rle:drle;image/emf:emf;image/fits:fits;image/g3fax:g3;image/gif:gif;image/heic:heic;image/heic-sequence:heics;image/heif:heif;image/heif-sequence:heifs;image/hej2k:hej2;image/hsj2:hsj2;image/ief:ief;image/jls:jls;image/jp2:jp2,jpg2;image/jpeg:jpeg,jpg,jpe;image/jph:jph;image/jphc:jhc;image/jpm:jpm;image/jpx:jpx,jpf;image/jxr:jxr;image/jxra:jxra;image/jxrs:jxrs;image/jxs:jxs;image/jxsc:jxsc;image/jxsi:jxsi;image/jxss:jxss;image/ktx:ktx;image/ktx2:ktx2;image/png:png;image/sgi:sgi;image/svg+xml:svg,svgz;image/t38:t38;image/tiff:tif,tiff;image/tiff-fx:tfx;image/webp:webp;image/wmf:wmf;message/disposition-notification:disposition-notification;message/global:u8msg;message/global-delivery-status:u8dsn;message/global-disposition-notification:u8mdn;message/global-headers:u8hdr;message/rfc822:eml,mime;model/3mf:3mf;model/gltf+json:gltf;model/gltf-binary:glb;model/iges:igs,iges;model/mesh:msh,mesh,silo;model/mtl:mtl;model/obj:obj;model/stl:stl;model/vrml:wrl,vrml;model/x3d+binary:x3db,x3dbz;model/x3d+fastinfoset:x3db;model/x3d+vrml:x3dv,x3dvz;model/x3d+xml:x3d,x3dz;model/x3d-vrml:x3dv;text/cache-manifest:appcache,manifest;text/calendar:ics,ifb;text/coffeescript:coffee,litcoffee;text/css:css;text/csv:csv;text/html:html,htm,shtml;text/jade:jade;text/jsx:jsx;text/less:less;text/markdown:markdown,md;text/mathml:mml;text/mdx:mdx;text/n3:n3;text/plain:txt,text,conf,def,list,log,in,ini;text/richtext:rtx;text/rtf:rtf;text/sgml:sgml,sgm;text/shex:shex;text/slim:slim,slm;text/spdx:spdx;text/stylus:stylus,styl;text/tab-separated-values:tsv;text/troff:t,tr,roff,man,me,ms;text/turtle:ttl;text/uri-list:uri,uris,urls;text/vcard:vcard;text/vtt:vtt;text/xml:xml;text/yaml:yaml,yml;video/3gpp:3gp,3gpp;video/3gpp2:3g2;video/h261:h261;video/h263:h263;video/h264:h264;video/iso.segment:m4s;video/jpeg:jpgv;video/jpm:jpm,jpgm;video/mj2:mj2,mjp2;video/mp2t:ts;video/mp4:mp4,mp4v,mpg4;video/mpeg:mpeg,mpg,mpe,m1v,m2v;video/ogg:ogv;video/quicktime:qt,mov;video/webm:webm".split(";")){const[s,i]=at(e,":");for(const e of i.split(","))t.set(e,s)}this.extTypeMap=t}static parseConf(t){return"auto"===t?[""]:[t]}onResponse(t,e,s){let i;if(""===this.mime){const t=e.fileConf.name.match(/\.(\w+)$/);if(t){const e=t[1].toLowerCase();i=z.extTypeMap.get(e)}if(!i){const t=s.headers.get("content-type");i=t?at(t,";")[0]:"application/octet-stream"}}else i=this.mime;t.headers.set("content-type",i)}}var O,H;z.reuse=!0,function(t){let e;function s(t){return e.match(t)}async function i(t,s){try{await e.put(t,s)}catch{}}function n(t){return e.delete(t)}t.init=async function(){e||(e=await caches.open(".freecdn"))},t.findHash=async function(t){const e=await s("/"+t);if(!e)return;const i=await e.clone().arrayBuffer(),a=new Uint8Array(i),r=await ht(a),o=Q(t);return o?nt(r,o)?e:(console.warn("[FreeCDN/CacheManager] bad cache:",t),void n("/"+t)):void 0},t.addHash=async function(t,e){await i("/"+t,e)},t.findCache=s,t.addCache=i,t.delCache=n}(O||(O={}));class ${constructor(t){this.name=t}open(t){const e=j(),s=indexedDB.open(this.name);return s.onsuccess=()=>{const i=s.result;this.db=i,i.onclose=()=>{console.warn("[FreeCDN/Database] indexedDB disconnected, reopen..."),this.open(t)},e.resolve()},s.onerror=t=>{console.warn("[FreeCDN/Database] indexedDB open error:",t),e.reject(s.error)},s.onupgradeneeded=()=>{const e=s.result;for(const[s,i]of Object.entries(t))e.createObjectStore(s,i)},e}close(){this.db.close()}get(t,e){const s=j(),i=this.getStore(t,"readonly").get(e);return i.onsuccess=()=>{s.resolve(i.result)},i.onerror=()=>{s.reject(i.error)},s}put(t,e){const s=j(),i=this.getStore(t,"readwrite").put(e);return i.onsuccess=()=>{s.resolve()},i.onerror=()=>{s.reject(i.error)},s}delete(t,e){const s=j(),i=this.getStore(t,"readwrite").delete(e);return i.onsuccess=()=>{s.resolve()},i.onerror=()=>{s.reject(i.error)},s}enum(t,e,...s){const i=j(),n=this.getStore(t,"readonly").openCursor(...s);return n.onsuccess=()=>{const{result:t}=n;if(!t)return void i.resolve();!1!==e(t.value)&&t.continue()},n.onerror=()=>{i.reject(n.error)},i}getStore(t,e){return this.db.transaction(t,e).objectStore(t)}}!function(t){let e,s,n=0,a=!1;const r=new Map;function o(t,e,i){if(r.has(t))return;const n={url:t,status:e,expire:i};r.set(t,n),s.put("cache",n)}class c{constructor(){this.lastDoneTime=0,this.lastErrTime=0,this.pending=0,this.errNum=0,this.reqNum=0,this.reqTimeAvg=-1,this.reqTimeSum=0}}const l=new Map;function p(t){let e=l.get(t);return e||(e=new c,l.set(t,e)),e}t.getUrlScore=function(t,s){const i=r.get(t);if(i&&i.expire<s)return 200!==i.status?-2:100+i.expire;if("/"===t[0])return-1;const n=ot(t),a=l.get(n);return a?function(t,e){if(-1!==t.reqTimeAvg){const e=100-.2*t.reqTimeAvg;return Math.max(e,10)}return 50}(a):e[n]||50},t.preservePerformanceEntries=function(t){a=t},t.fetch=async function(t){const e=p(ot(t.url));e.pending++;const s=st();let n;try{n=await i(t)}catch(i){throw function(t,e,s,i){if(!navigator.onLine)return;if(!h.test(t.message))return;if("only-if-cached"===e.cache)return;s.errNum++,s.lastErrTime=i}(i,t,e,s),i}finally{e.pending--}switch(n.status){case 200:if("no-store"!==t.cache){const t=function(t,e){const s=t.get("cache-control");if(null!==s){if(s.includes("no-cache"))return 0;const t=s.match(/(?:^|,\s*)max-age="?(\d+)"?/);if(t)return+t[1]}const i=t.get("expires");if(null!==i){const t=Date.parse(i)/1e3;if(t)return t-e|0}return-1}(n.headers,s);t>60&&o(n.url,200,s+t)}break;case 404:o(n.url,404,s+300)}return n};const h=/^Failed to fetch|^NetworkError|^Could not connect/;function u(){const t=performance.getEntriesByType("resource"),e=t.length;if(0===e)return;let s=0;if(a){if(e===n)return;s=n}const i=performance.timeOrigin;for(let n=s;n<e;n++){const e=t[n],s=p(ot(e.name));if(s.reqNum++,s.lastDoneTime=i+e.responseEnd,e.responseStart>0){const t=e.responseStart-e.requestStart;s.reqTimeSum+=t,s.reqTimeAvg=s.reqTimeSum/s.reqNum;const i=e.responseEnd-e.responseStart;e.encodedBodySize}}a?n=e:performance.clearResourceTimings()}t.init=async function(){e=ut[navigator.language]||ut["*"],s=new $(".freecdn"),await s.open({cache:{keyPath:"url"}});const t=st();await s.enum("cache",(e=>{e.expire<t?s.delete("cache",e.url):r.set(e.url,e)})),performance.onresourcetimingbufferfull=t=>{a||u()},u(),setInterval(u,2e3)}}(H||(H={}));const W=new TextEncoder,K=new TextDecoder;function G(t){return K.decode(t)}function Z(t){return btoa(function(t){return t.reduce(((t,e)=>t+String.fromCharCode(e)),"")}(t))}function Q(t){try{t=atob(t)}catch{return}const e=new Uint8Array(t.length);for(let s=0;s<e.length;s++)e[s]=t.charCodeAt(s);return e}function Y(t){try{return JSON.parse(t)}catch{}}function J(t){return(t=t.trim())?t.split(/\s+/):[]}function V(t){if('"'===t[0]){if(void 0===(t=Y(t)))return;return function(t){return W.encode(t)}(t)}return Q(t)}const X={"":1,ms:1,s:1e3,min:6e4,h:36e5,d:864e5,y:31536e6};function tt(t){const e=t.match(/^([\d.]{1,9})(y|d|h|min|s|ms|)$/);if(!e)return NaN;const[,s,i]=e;return+s*X[i]}function et(t){const e=t.match(/^([\d.]{1,9})(k|K|M|G|)(i|)(b|B|)$/);if(!e)return NaN;const[,s,i,n,a]=e;return+s*(n?1024:1e3)**("k"===i||"K"===i?1:"M"===i?2:"G"===i?3:0)/("b"===a?8:1)}function st(){return Date.now()/1e3|0}function it(t,e=0){if(0===e)for(const s of t)e+=s.length;const s=new Uint8Array(e);let i=0;for(const e of t)s.set(e,i),i+=e.length;return s}function nt(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}function at(t,e){const s=t.indexOf(e);return-1===s?[t]:[t.substr(0,s),t.substr(s+e.length)]}function rt(t,e){for(const[s,i]of e)t.set(s,i)}function ot(t){return t.match(/^https?:\/\/([^/]+)/)[1]}const ct=location.origin+"/",lt=location.origin.length;function pt(t){return t.startsWith(ct)?t.substr(lt):t}async function ht(t){const e=await r.digest("SHA-256",t);return new Uint8Array(e)}const ut={"zh-CN":{"ajax.cdnjs.com":50,"cdnjs.cloudflare.com":50,"cdn.jsdelivr.net":80,"raw.githubusercontent.com":10,"cdnjs.loli.net":70,"lib.baomitu.com":80,"cdn.staticfile.org":90,"cdn.bootcss.com":90,"cdn.bootcdn.net":80,"unpkg.com":50,"g.alicdn.com":90,"pagecdn.io":20,"ajax.aspnetcdn.com":60,"ajax.googleapis.com":10,"code.jquery.com":20,"stackpath.bootstrapcdn.com":30,"maxcdn.bootstrapcdn.com":30,"cdn.datatables.net":40,"twemoji.maxcdn.com":40},"*":{"ajax.cdnjs.com":90,"cdnjs.cloudflare.com":90,"cdn.jsdelivr.net":40,"raw.githubusercontent.com":10,"cdnjs.loli.net":40,"lib.baomitu.com":20,"cdn.staticfile.org":20,"cdn.bootcss.com":20,"cdn.bootcdn.net":20,"unpkg.com":40,"g.alicdn.com":30,"pagecdn.io":40,"ajax.aspnetcdn.com":70,"ajax.googleapis.com":90,"code.jquery.com":50,"stackpath.bootstrapcdn.com":40,"maxcdn.bootstrapcdn.com":50,"cdn.datatables.net":50,"twemoji.maxcdn.com":50}}}();
//# sourceMappingURL=https://unpkg.com/freecdn-js@0.1.2/dist/freecdn-main.min.js.map
